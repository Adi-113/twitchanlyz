<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Streamer Communities Network (D3.js)</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { margin:0; font-family: 'Segoe UI', Tahoma, sans-serif; }
    #community { width:100vw; height:100vh; background: #000000; }
    .link { stroke: #aaa; stroke-width: 1px; }
    .node { stroke: #fff; stroke-width: 1.5px; cursor: pointer; }
    .tooltip {
      position: absolute;
      padding: 6px 10px;
      background: rgba(0,0,0,0.7);
      color: #fff;
      border-radius: 4px;
      pointer-events: none;
      font-size: 12px;
      visibility: hidden;
    }
    .legend {
      font-size: 14px;
    }
    .legend-item { cursor: pointer; }
    .legend-color { width: 12px; height: 12px; display: inline-block; margin-right: 4px; }
  </style>
</head>
<body>
  <div id="community"></div>
  <div id="tooltip" class="tooltip"></div>
  <script>
    const width = window.innerWidth;
    const height = window.innerHeight;
    const svg = d3.select('#community').append('svg')
      .attr('width', width)
      .attr('height', height);

    const tooltip = d3.select('#tooltip4');

    // Load community data: nodes with {id, group}, links with {source, target}
    d3.json('community_data.json').then(({nodes, links}) => {
      // extract unique groups for color scale
      const groups = Array.from(new Set(nodes.map(d => d.group)));
      const color = d3.scaleOrdinal(d3.schemeDark2).domain(groups);

      // simulation
      const simulation = d3.forceSimulation(nodes)
        .force('link', d3.forceLink(links).id(d => d.id).distance(80).strength(0.9))
        .force('charge', d3.forceManyBody().strength(-500))
        .force('center', d3.forceCenter(width/2, height/2));

      // zoom
      const container = svg.append('g');

      // draw links
      const link = container.append('g')
        .attr('class', 'links')
        .selectAll('line')
        .data(links)
        .join('line')
          .attr('class', 'link');

      // draw nodes
      const node = container.append('g')
        .attr('class', 'nodes')
        .selectAll('circle')
        .data(nodes)
        .join('circle')
          .attr('class', 'node')
          .attr('r', 8)
          .attr('fill', d => color(d.group))
          .on('mouseover', (event, d) => {
            tooltip.html(`<strong>${d.id}</strong><br/>${d.group}`)
                   .style('visibility', 'visible');
          })
          .on('mousemove', event => {
            tooltip.style('top', (event.pageY+10)+'px')
                   .style('left',(event.pageX+10)+'px');
          })
          .on('mouseout', () => tooltip.style('visibility', 'hidden'))
          .call(d3.drag()
            .on('start', (event, d) => {
              if (!event.active) simulation.alphaTarget(0.3).restart();
              d.fx = d.x; d.fy = d.y;
            })
            .on('drag', (event, d) => { d.fx = event.x; d.fy = event.y; })
            .on('end', (event, d) => {
              if (!event.active) simulation.alphaTarget(0);
              d.fx = null; d.fy = null;
            })
          );

      simulation.on('tick', () => {
        link
          .attr('x1', d => d.source.x)
          .attr('y1', d => d.source.y)
          .attr('x2', d => d.target.x)
          .attr('y2', d => d.target.y);
        node
          .attr('cx', d => d.x)
          .attr('cy', d => d.y);
      });

      // legend
      const legend = svg.append('g')
        .attr('class','legend')
        .attr('transform','translate(20,20)');
      groups.forEach((g,i) => {
        const item = legend.append('g')
          .attr('class','legend-item')
          .attr('transform', `translate(0,${i*20})`);
        item.append('rect')
          .attr('class','legend-color')
          .attr('fill', color(g));
        item.append('text')
          .attr('x', 16)
          .attr('y', 12)
          .text(g);
      });
    });
  </script>
</body>
</html>
